# Contribution Guidelines

In order to locally build Athenian web app image, and run it, run:

```bash
$ docker build --tag=athenian-app .
$ docker run --rm --publish=8080:80 --name=athenian-app athenian-app
```

Then you can open http://localhost:8080 in your browser, and see the Athenian web app.


## Development

This project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).


### Requirements

- Install [Node.js](https://nodejs.org) (v10+) and [Yarn](https://yarnpkg.com/en/docs/install) (v1+).


### Available Scripts

In the project directory, you can run:

- `make serve`: Runs the webapp in the development mode under http://localhost:3000. The page will hot-reload on every edits, and lint errors will appear in the console,
- `make test`: Runs the app tests in interactive watch mode,

#### Autogenerated code

Running `make generate` it will be generated different parts of the app.

For the generation of the Athenian OpenAPI client from Athenian API scheme, you'll need a GitHub access token (with `repo` scope) to download the [API schema](https://github.com/athenianco/athenian-api/blob/master/server/athenian/api/openapi/openapi.yaml). You can add it into the `.env` file in `athenian-webapp` root folder:

```env
GITHUB_TOKEN=__TOKEN__
```

or pass it explicitely by the command line (not recommended):

```bash
$ GITHUB_TOKEN=__TOKEN__ make api-generate
```


### Auth0 and GitHub App local testing

For locally testing the authentication, you need to configure Auth0 and GitHub to work together. Follow these steps or refer to Auth0 and GitHub docs.

You also need to run the [Athenian API](https://github.com/athenianco/athenian-api) and configure it in order to connect to your "Auth0 Management API"

#### 1. Create a Single-Page Application in Auth0
_See [SPA application docs](https://auth0.com/docs/dashboard/guides/applications/register-app-spa) at Auth0._

Create an Application with "Application Type" set to "Single Page Application", using the following settings (eventually change the port with the one you plan to use):
- Token Endpoint Authentication Method: "none"
- "Allowed Callback URLs": `http://localhost:3000/login/callback`
- "Allowed Web Origins": `http://localhost:3000`
- "Allowed Logout URLs": `http://localhost:3000`

#### 2. Create a Machine-to-Machine Application in Auth0
_See [M2M application docs](https://auth0.com/docs/dashboard/guides/applications/register-app-m2m) at Auth0._


Create an Application with "Application Type" set to "Machine to Machine"
- When asked for an API you want to authorize, choose "Auth0 Management API"
- "Scopes": `read:users`
- You don't need to configure any other value

#### 3. Connect your Auth0 app to a GitHub OAuth App
_See [social connection docs](https://auth0.com/docs/connections/social/github) at Auth0._

1. Register a new OAuth App in GitHub,  with these settings:
    - "Homepage URL": `http://localhost:3000`
    - "Authorization callback URL": `https://<auth0 domain>/login/callback` (e.g., `your-app.eu.auth0.com`)
2. Enable the connection with GitHub from your Auth0 Dashboard providing the `Client ID` and `Client Secret` of the GitHub OAuth App from the previous step, and ask for these permissions:
    - `read:user`

#### 4. Configure Athenian WebApp

Update the [`config.js`](https://github.com/athenianco/athenian-webapp/blob/master/public/config.js) file:
- `auth.domain`, `auth.clientId`, `auth.redirectUri` and `auth.logoutRedirectUri` with the corresponding values of your Auth0 Single Page Application created by [#1](#1-create-a-single-page-application-in-auth0).
- `auth.audience` will be the one for your "Auth0 Management API" (e.g. https://your-tenant.eu.auth0.com/api/v2/).
- `api.basePath` must be the url of your [Athenian API](https://github.com/athenianco/athenian-api)


#### 5. Configure Athenian API
Configure your [Athenian API](https://github.com/athenianco/athenian-api) (using the `.env` file if you're running it locally):
- `AUTH0_DOMAIN`, `AUTH0_CLIENT_ID` and `AUTH0_CLIENT_SECRET` with the corresponding values of your Auth0 Machine to Machine Application created in [#2](#2-create-a-machine-to-machine-application-in-auth0).
- `AUTH0_AUDIENCE` will be the one for your "Auth0 Management API" (e.g. https://your-tenant.eu.auth0.com/api/v2/).
